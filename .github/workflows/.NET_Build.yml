name: .NET Build

on:
  pull_request:
    types: [closed]
    branches:   
      - Feature1
  workflow_dispatch:

permissions:
  contents: write
  packages: write
  actions: read
  id-token: write
  
run-name: Build from ${{ github.ref_name }} with Sonar and Fortify

jobs:
  if_PR_merged:
    runs-on: ubuntu-latest
    outputs:
      Sonar: ${{ steps.pr_merge.outputs.Sonar }}
      Fortify: ${{ steps.pr_merge.outputs.Fortify }}
    steps:
    - name: PR_Check
      id: pr_merge
      run: |
          Sonar="true"
          Fortify="true"
          echo "The PR was merged.. Triggering the Build"
          echo "Sonar=$Sonar" >> $GITHUB_OUTPUT
          echo "Fortify=$Fortify" >> $GITHUB_OUTPUT
        
  Build:
    needs: if_PR_merged
    runs-on: ubuntu-latest
    steps:
    - name: Build
      run: |
           echo "dotnet build-test"
           exit 0
      
    - name: sonar
      if: ${{ needs.if_PR_merged.outputs.Sonar == 'true' }}
      run: |
           echo Sonar
           
  Fortify:
    runs-on: ubuntu-latest
    needs: [Build]
    steps:
    - name: Fortify
      run: |
           echo "Fortify-test"
    
     
  Upload_Artifact_GitHub_Release:         
       runs-on: ubuntu-latest
       needs: [Build,Fortify]  
       steps:
         - run: echo test
